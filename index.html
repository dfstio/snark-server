<!doctype html>
<html>
<head>
  <title>List SNARK proof generation in the browser</title>
</head>
<body>

  <h1>List SNARK proof generation in the browser</h1>
  <button id="bGenGrothProof"> Create Groth16 proof </button>
  <button id="bGenPlonkProof"> Create PLONK proof </button>

  <!-- JS-generated output will be added here. -->
  <pre class="message">  <code id="message"></code></pre>
  
  <pre class="time"> Time taken: <code id="time"></code></pre>

  <pre class="proof"> Valid?: <code id="result"></code></pre>

  <pre class="proof"> Proof: <code id="proof"></code></pre>

  <script src="./node_modules/snarkjs/build/snarkjs.min.js">   </script>


  <!-- This is the bundle generated by rollup.js -->
  <script>

const proofCompnent = document.getElementById('proof');
const resultComponent = document.getElementById('result');
const timeComponent = document.getElementById('time');
const messageComponent = document.getElementById('message');
const bGenGrothProof = document.getElementById("bGenGrothProof");
const bGenPlonkProof = document.getElementById("bGenPlonkProof");

bGenGrothProof.addEventListener("click", calculateGrothProof);
bGenPlonkProof.addEventListener("click", calculatePlonkProof);

async function calculateGrothProof() {

    messageComponent.innerHTML = "Generating Groth16 proof...";
    const input = await fetch("./groth16/input.json").then( function(res) {
        return res.json();
    });

	const start = Date.now();
    const { proof, publicSignals } = await snarkjs.groth16.fullProve(input, "./groth16/msmtadd.wasm", "./groth16/msmtadd.zkey");

    const end = Date.now();
    const timeTaken = ((end - start) / 1000).toString() + ' seconds';

    timeComponent.innerHTML = timeTaken;

    proofCompnent.innerHTML = JSON.stringify(proof, null, 1);
    
    messageComponent.innerHTML = "Verifying Groth16 proof...";

    const vkey = await fetch("./groth16/verification_key.json").then( function(res) {
        return res.json();
    });

    const res = await snarkjs.groth16.verify(vkey, publicSignals, proof);

    resultComponent.innerHTML = res;
    messageComponent.innerHTML = "Done";
}

async function calculatePlonkProof() {

	messageComponent.innerHTML = "Generating PLONK proof...";
    const input = await fetch("./plonk/input.json").then( function(res) {
        return res.json();
    });
    
    const start = Date.now();
    const { proof, publicSignals } = await snarkjs.plonk.fullProve(input, "./plonk/claim.wasm", "./plonk/pclaim.zkey");
      //await snarkjs.plonk.fullProve( {in: [0, 0]}, "zkeys/Hasher_2-1.test.wasm", "zkeys/Hasher_2-1.test.zkey");

    const end = Date.now();
    const timeTaken = ((end - start) / 1000).toString() + ' seconds';

    timeComponent.innerHTML = timeTaken;

    proofCompnent.innerHTML = JSON.stringify(proof, null, 1);
    
    messageComponent.innerHTML = "Verifying PLONK proof...";

    const vkey = await fetch("./plonk/verification_keypc.json").then( function(res) {
        return res.json();
    });

    const res = await snarkjs.plonk.verify(vkey, publicSignals, proof);

    resultComponent.innerHTML = res;
    messageComponent.innerHTML = "Done";
}

  </script>

</body>
</html>
